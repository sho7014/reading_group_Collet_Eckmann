\documentclass[a4paper,11pt,fleqn]{article}
\usepackage[chap=2]{../ex}

\begin{document}

\maketitle
\subsection*{Errata}
\begin{itemize}
    \item p.~11, Sec.~2.3, para.~2: 

    error: $h:\Omega \to \mathbb{R}^t$

    correction: $h:\Omega \to \mathbb{R}$

    \item p.~15: 

    error: $\varrho = \sqrt{u^2+v^2}$

    correction: $\varrho = \sqrt{u^2+v^2}-1$

    \item p.~15: 

    error: $\varrho + 0.4\cos(\varphi)$

    correction: $0.25\varrho + 0.4\cos(\varphi)$

\end{itemize}
\hruleskip
\subsection{2.5.}
($\Rightarrow$) Let ${\varphi}_t, {\psi}_t$ be flows of ${\bf X}, {\bf Y}$ respectively. The definition of the flow leads to
\begin{equation}
    \dot{\varphi}_t({\bm x}) = {\bf X}({\varphi}_t({\bm x})), \quad \dot{\psi}_t({\bm x}) = {\bf Y}({\psi}_t({\bm x})).  \label{eq: flow}
\end{equation}
Suppose a diffeomorphism ${\bf \Phi}$ conjugates the flows, i.e., 
${\bf \Phi} \circ {\varphi}_t ({\bm x}) = {\psi}_t \circ {\bf \Phi}({\bm x})$. By differentiating both sides of this equation w.r.t. $t$, 
\begin{align}
    &\left[ {\mathrm D}{\bf \Phi}({\varphi}_t({\bm x})) \right]\dot{\varphi}_t({\bm x}) = \dot{\psi}_t \circ {\bf \Phi}({\bm x}) \nonumber \\
    \Leftrightarrow &\left[ {\mathrm D}{\bf \Phi}({\varphi}_t({\bm x})) \right]{\bf X}({\varphi}_t({\bm x})) = {\bf Y}({\psi}_t \circ {\bf \Phi}({\bm x}))
\end{align}
Let $t=0$, then we obtain 
\begin{equation}
    {\rm D}_x{\bf \Phi}\cdot {\bf X}({\bm x}) = {\bf Y}({\bf \Phi}({\bm x})), \label{diffeo25}
\end{equation}
since ${\varphi}_0, {\psi}_0$ are identity maps. 
\vskip 1.0em

($\Leftarrow$) Consider a diffeomorphism ${\bf \Phi}$ which satisfies Eq.~(\ref{diffeo25}). Let ${\bm y}(t) = {\bf \Phi}\circ {\varphi}_t ({\bm x})$. Then 
\begin{align}
    \dot{\bm y}(t) = D{\bf \Phi}({\varphi}_t({\bm x})){\bf X}({\varphi}_t({\bm x})) &= {\bf Y}\circ {\bf \Phi} \circ {\varphi}_t ({\bm x}) \quad (\because \ \text{eq.~}(\ref{diffeo25})) \nonumber \\
    &= {\bf Y}({\bm y}(t)). 
\end{align}
Thus ${\bm y}(t)$ is a solution of the ODE of the vector field ${\bf Y}$ and of the initial condition ${\bf \Phi}({\bm x})$. That is, ${\bm y} (t)= {\psi}_t \circ {\bf \Phi}({\bm x})$. 

\hruleskip

\subsection{2.14.}
In the $(\varrho,\varphi,w)$ coordinate system, the torus is written as 
\begin{equation}
    (\varrho,\varphi,w)^\top = (0.8\sin{\vartheta},\varphi,0.8\cos{\vartheta})^\top.
\end{equation}
Let ${\bm S}$ be the solenoid map and ${\bm p}_1 = (\varrho_1,\varphi_1,w_1)^\top, {\bm p}_2 = (\varrho_2,\varphi_2,w_2)^\top$. Suppose ${\bm S}({\bm p}_1) = {\bm S}({\bm p}_2) $. Then $\varphi_1=\varphi_2$ follows from the second component of this equation. The other components provide $\varrho_1=\varrho_2, w_1 = w_2$. Therefore the solenoid map is injective. The solenoid map operates as
\begin{equation}
    {\bm S}({\bm p})= (0.2\sin{\vartheta}+0.4\cos{\varphi},2\varphi,0.2\cos{\vartheta}+0.4\sin{\varphi})^\top. 
\end{equation}
Then we obtain 
\begin{align}
    S({\bm p})_1^2+S({\bm p})_3^2 = 0.2+0.16\sin{\vartheta}\cos{\varphi}+0.16\cos{\vartheta}\sin{\varphi} \le 0.52 < 0.64 = ({\bm p})_1^2+({\bm p})_3^2. 
\end{align}
Thus the injection is strict. 

\hruleskip

\subsection{2.16.}
Let $J_f := \{I_{f,j}\}_j = \{[a_{f,j},a_{f,j+1})\}_j$ be a set of intervals associated with a piecewise expanding map $f$ï¼Ž

\begin{lemma}\label{lem: expandingmap}\mbox{}\par 
Let $f, g$ be piecewise expanding maps. The phase space of $g\circ f$ can be decomposed into subintervals of the elements of $J_f$ such that $g\circ f$ is monotone and $C^2$ in each of the subintervals.  
\end{lemma}
\begin{proof}\mbox{}\par
Let $K$ be a minimal set which satisfies $f(I_{f,j})\subset \cup_{k\in K}I_{g,k}$. Since $f$ is monotone on $I_{f,j}$, 
\begin{equation}
    f(x) = a_{g,\min{K}+k'} \label{eq: eqnedge}
\end{equation}
have unique solution in $I_{f,j}$. Let $b_{j,k'} \ (1 \le k' \le |K|-1)$ be such solutions. 
Consider a finite sequence $a_{f,j} = b_{j,0} < b_{j,1} < \cdots < b_{j,|K|} = a_{f,j+1}$ and let $L_{j,p} := [b_{j,p},b_{j,p+1})$. 
$f, g$ are monotone $C^2$ maps on each $L_{j,p}$, so its composition $f \circ g$ is. 
\end{proof}
Suppose $f^n$ be a piecewise expanding map. The Lemma.~\ref{lem: expandingmap} tells us that the phase space of $f^{n+1}$ can be decomposed into intevals in each of which $f^{n+1}$ is monotone and $C^2$. 
Also, 
\begin{equation}
    |(f^{(n+1)m})'| \ge c^{n+1} >1
\end{equation}
holds. Therefore, $f^{n+1}$ is a piecewise expanding map. The proposition follows by induction. 
\hruleskip

\subsection{2.19.}
\begin{align}
    &f_2 \circ \Phi = 1-2\sin^2{\frac{\pi x}{2}} = \cos{\pi x} \nonumber \\
    &\Phi \circ g = \sin{\frac{\pi}{2}\left(1-2|x|\right)} = \sin\left({\frac{\pi}{2}-\pi |x|}\right) =\cos{\pi |x|} =\cos{\pi x} \nonumber \\
    &\therefore  f_2 \circ \Phi = \Phi \circ g
\end{align}

\hruleskip

\subsection{2.21.}
\begin{equation}
    \mathcal{S}^{-1}({\bf x})_j = x_{j-1}
\end{equation}

\hruleskip

\subsection{2.22.}
Let $\ \bar{} \ $ denotes a periodic part of a dyadic representation.  

If a number $x$ has a finite dyadic representation, it give rise to two representations as follows: 
\begin{align}
    x & = 0.a_1a_2a_3\cdots a_m 1 \bar{0} \nonumber \\
      & = 0.a_1a_2a_3\cdots a_m 0 \bar{1}. 
\end{align}
Thus its dyadic representation is not unique. 

Suppose that a number $x$, which admits no finite dyadic representation, have two different dyadic representation: 
\begin{align}
    x_a & = 0.a_1a_2a_3\cdots \nonumber \\
    x_b  & = 0.b_1b_2b_3\cdots  
\end{align}
Let $n$ be minumum $i$ that satisfies $a_i \neq b_i$. We can assume $a_n = 1, b_n = 0$ w.l.o.g. This means $x_a \ge x_b$ and the equality holds iff $a_{n'}=0, b_{n'} = 1 \ (n' \ge n+1)$. This contradicts our assumption that $x$ admits no finite dyadic representation. Thus such number has a unique dyadic representation. 

Therefore, the set of numbers of nonunique dyadic representation coincides with that of finite dyadic representation. The number of finite dyadic representation is rational, since it is a sum of rationals. Thus the set of numbers of nonunique dyadic representation is countable, since it is a subset of $\mathbb{Q}$. 
\hruleskip

\subsection{2.23.}

Let $x_*$ be a 32 bit (approximated) representation of $x\in [0,1)$. The inteval map act as a unilateral shift in the representation. Hence, the bits are moved to the left in order, during which the leftmost ones are discarded. When the map is applied 32 times, the least significant bit of $x_*$ is discarded at last, then bits of zeros remain. This is apparently the fixed point. 

The same applies to the case of 64 bit representation. 
\hruleskip

\subsection{2.24.}

Let $I_j := [a_j, a_{j+1})$. 
\vskip 1.0em

(injectivity) Suppose two different numbers $x_1, x_2 \in \Omega, x_1 < x_2$ share the same code, i.e., ${\bm \sigma}_1 =  {\bm \sigma}_2 \ (= {\bm \sigma})$. 

Let us show that for any $n \in \mathbb{Z}^+$, $f^n$ is monotone and $C^2$ on $[x_1, x_2]$. The base case ($n=0$) holds by definition. Suppose that $f^k$ is monotone $C^2$ map on $[x_1, x_2]$ and that $f^{k+1}$ fails to have such regularity on the interval. $f^{k+1}$ lacks such regularity only when $f^k(x_1)$ and $f^k(x_2)$ belong to different intervals $I_l, I_{l'}, l\neq l'$. This violates the assumption that ${\bm \sigma}_1 =  {\bm \sigma}_2$. Thus $f^{k+1}$ is monotone $C^2$ map on $[x_1, x_2]$. Hence the proposition follows by induction. 

Since $f$ is piecewise expanding map, there exists $m>0$ and $c>1$ such that $| (f^{m})' |>c$. Let $p \in \mathbb{N}$ satisfy $(x_2-x_1)c^p>1$. 
Using the mean value theorem and the monotonicity of $f^{mp}$, we obtain $|f^{mp}(x_2)-f^{mp}(x_1)|>1$. This contradicts the fact that $f^{mp}$ is a piecewise expanding map.

The argument above shows that the coding is injective.  
\vskip 1.0em

(well-definedness) Let $\Phi_{\mathcal R} =  (\Omega,\Omega_s,R)$ be the coding \href{https://proofwiki.org/wiki/Definition:Relation}{relation}, where 
\begin{align}
    &\Omega_s:=\left\{\mathbf{x} \in \mathcal{A}^{\mathbb{Z}^+} \mid M_{x_j, x_{j+1}}=1, \quad \forall j \in \mathbb{Z}^+\right\}, \quad \mathcal{A}:=\{0,1,2,\cdots,k-1\}, \\
    &M_{ij} = \left\{ \begin{array}{cc}
        1 & \text{if} \quad I_j \subset f(I_i) \\
        0 &  \text{otherwise} 
    \end{array} \right. ,
\end{align}
and 
\begin{equation}
    R = \{(x,{\bm \sigma}) \mid {\bm \sigma} \in \Omega_s \ \text{and} \ f^n(x) \in I_{{\bm \sigma}_n} \ \text{for all} \ n \in \mathbb{Z}^+\}.
\end{equation}
\begin{lemma}\label{lem: uniquecoding}\mbox{}\par 
Let $\bar{\Omega}:= \{ x\in \Omega \mid f^n(x) \notin \{a_j\}_{j=0}^{k-1} \ \text{for all} \ n\in \mathbb{Z}^+ \}$, then the \href{https://proofwiki.org/wiki/Definition:Restriction}{restriction} $\Phi_{\mathcal R} |_{\bar{\Omega}}$ is many-to-one. 
\end{lemma}
\begin{proof}\mbox{}\par
Let as assume $\Phi_{\mathcal R} |_{\bar{\Omega}}$ is not many-to-one, i.e., there exist $x\in \bar{\Omega}$ and ${\bm \sigma}_1, {\bm \sigma}_2 \in \Omega_s, {\bm \sigma}_1 \neq {\bm \sigma}_2 $ such that $(x,{\bm \sigma}_1), (x,{\bm \sigma}_2) \in R$. This implies there exists $p \in \mathbb{Z}^+$ such that $f^p(x) \in I_{{\sigma_1}_p}, f^p(x) \in I_{{\sigma_2}_p}, {\sigma_1}_p \neq {\sigma_2}_p$ and $f^p(x) \notin \{a_j\}_{j=0}^{k-1}$. This means that $f^p(x)$ is not many-to-one. This contradicts the fact that $f$ is a function. Thus $\Phi_{\mathcal R} |_{\bar{\Omega}}$ is many-to-one.   
\end{proof}
Let $\mathcal{B}_n = \{x\in \Omega \mid f^n(x) \in \{a_j\}_{j=0}^{k-1}\}$. Obviously $|\mathcal{B}_n|\le (k-1)^{n+1}$. Hence $\Omega \setminus \bar{\Omega} = \cup_{i=0}^\infty{\mathcal{B}_n}$ is countable since a countable union of countable sets is countable. 

Thus the coding relation $\Phi_{\mathcal R}$ gives rise to a well-defined injective function except for a countable number of exceptional points $\Omega \setminus \bar{\Omega}$. 
\vskip 1.0em

(conjugacy) Let us define $\bar{\Omega}_s:= \{{\bm \sigma} \in \Omega_s \mid (x, {\bm \sigma})\notin R \ \text{for all} \ x \in \Omega \setminus \bar{\Omega} \}$. $\Omega_s \setminus \bar{\Omega}_s$ is countable since $x \in \mathcal{B}_n$ gives rise to at most two ordered pairs in $R$. 
Let us show $\Phi:= \Phi_{\mathcal R} |_{\bar{\Omega}\times \bar{\Omega}_s}$ is invertible mapping. The injectivity is already given. 

If ${\bm \sigma}\in\Phi(\bar{\Omega})$,  $I_{\sigma_{j+1}} \subset f(I_{\sigma_j})$ for all $j\in\mathbb{Z}^+$ due to the Markov property. Hence $\Phi(\bar{\Omega})\subset \Omega_s$. Further we can show $\Phi(\bar{\Omega})\subset \bar{\Omega}_s$ since $\bar{\Omega} \cap (\Omega \setminus \bar{\Omega}) = \emptyset$. 
Suppose there exists ${\bm \sigma}\in \bar{\Omega}_s$ such that ${\bm \sigma} \notin \Phi(\bar{\Omega})$. This implies that there exists a minimum $q$ such that $I_{\sigma_q} \cap f^q(I_{\sigma_0}) = \emptyset$. 
$f^r(I_j) \ (\forall r \in \mathbb{Z}^+)$ can be written as $\cup_{j' \in \mathcal B}I_{j'}$ for some $\mathcal{B}\subset \mathcal{A}$ due to the Markov property. Hence $I_{\sigma_{q-1}} \cap f^{q-1}(I_{\sigma_0}) = I_{\sigma_{q-1}}$ since it is not empty. Then we obtain
\begin{align}
    I_{\sigma_{q}} \subset f(I_{\sigma_{q-1}}) = f(I_{\sigma_{q-1}} \cap f^{q-1}(I_{\sigma_0})) \subseteq f(I_{\sigma_{q-1}}) \cap f^{q}(I_{\sigma_0}). 
\end{align}
Thus $I_{\sigma_q}$ is a subset of $f^{q}(I_{\sigma_0})$ and then $I_{\sigma_q} \cap f^q(I_{\sigma_0}) = I_{\sigma_q} \neq \emptyset$. This contradicts the assumption and thus we obtain $\Phi(\bar{\Omega})\supset \bar{\Omega}_s$. Thus $\Phi$ is surjective. 

Thus the coding $\Phi$, defined except for a countable number of exceptional points $(\Omega \setminus \bar{\Omega}) \times (\Omega_s \setminus \bar{\Omega}_s)$, provides a conjugacy between $f$ and the unilateral shift of finite type defined using $M$.  
\hruleskip

\subsection{2.26.}
The inverse of the baker's map is given as 
\begin{equation}
    f^{-1}(x,y) = \left\{ \begin{array}{lcc}
        (x/2,2y) & \text{if} & y < 1/2 \\
        ((1+x)/2,2y-1) & \text{if} & y \ge 1/2
    \end{array}\right. .
\end{equation}
\vskip 1.0em

Suppose two points ${\bm x}_1, {\bm x}_2 \in [0,1)^2$ share the same code, i.e., ${\bm \sigma}_1 =  {\bm \sigma}_2 \ (= {\bm \sigma})$, where ${\bm \sigma}_i$ is associated with ${\bm x}_i$. Let ${\bm \sigma}^{\ge}$ (resp. ${\bm \sigma}^{\le}$) be a subcode of ${\bm \sigma}$ of positive (resp. negative) indices, i.e., ${\bm \sigma}^{\ge}:= (\sigma_i)_{i\ge 0}$ (resp. ${\bm \sigma}^{\le}:= (\sigma_i)_{i\le 0}$). We call it a positive semi-infinite (resp. negative) subcode. 

Two points which share their $y$-component have the same positive semi-infinite subcode since the $y$-component does not affect the positive time-evolution of the $x$-component. Let ${\bm x}_{2*}:= (x_{2,1},x_{1,2})$, then ${\bm \sigma}^{\ge}_1 = {\bm \sigma}^{\ge}_2 = {\bm \sigma}^{\ge}_{2*}$ follows. ${\bm \sigma}^{\ge}_1 = {\bm \sigma}^{\ge}_{2*}$ requires $x_{1,1}=x_{2,1}$ because $g(x):=f(x,x_{1,2})$ is a piecewise expanding map. Similarly, we can show $x_{1,2}=x_{2,2}$ by considering the negative semi-infinite subcode. Thus the coding is injective. 
\vskip 1.0em

Let $\Omega_s$ denote the phase space of the full bilateral shift over the two symbols and $\Phi_{\mathcal R} =  (\Omega,\Omega_s,R)$ be the coding relation as in the solution of the previous exercise (we must replace $\mathbb{Z}^+$ with $\mathbb{Z}$). It can be easily seen that $\Phi_{\mathcal R}$ gives rise to a well-defined injective function except for a countable number of exceptional points $\mathbb{Q}_{\rm dr}^2$, where $\mathbb{Q}_{\rm dr}$ is a set of dyadic rationals. Let us introduce $\bar{\Omega}:= \Omega \setminus \mathbb{Q}_{\rm dr}^2, \bar{\Omega}_s$ and $\Phi$ as in the last exercise. 
\vskip 1.0em

Let us show $\Phi(\bar{\Omega})=\bar{\Omega}_s$. 
Obviously $\Phi(\bar{\Omega}) \subset \bar{\Omega}_s$ since the shift is full. 
Let $I_0 = [0,1/2)\times [0,1), I_1 = [1/2,1)\times [0,1)$. Suppose there exists ${\bm \sigma}\in \bar{\Omega}_s$ such that ${\bm \sigma} \notin \Phi(\bar{\Omega})$. This implies that there exists $q\in\mathbb{Z}$ such that $I_{\sigma_q} \cap f^q(I_{\sigma_0}) = \emptyset$. Apparently ${\bm \sigma} \notin \Phi(\bar{\Omega})$ holds if and only if $\mathcal{S}^{r}({\bm \sigma}) \notin \Phi(\bar{\Omega})$ for all $r\in \mathbb{Z}$. We take an $r$ which satisfies $r<q$ and denote $q':=q-r$. Then $I_{\mathcal{S}^{r}({\bm \sigma})_{q'}} \cap f^{q'}(I_{\mathcal{S}^{r}({\bm \sigma})_0}) = \emptyset$. This cannot hold because the positive time-evolution of the $x$-component by the baker's map is given by a piecewise expanding Markov map (see the solution of Exercise 2.24) of its associated transition matrix $M_{i,j}=1, \forall i,j\in \{0, 1\}$. Thus $\Phi(\bar{\Omega})=\bar{\Omega}_s$, namely, $\Phi$ is bijective. Hence the coding $\Phi$ provides a desired conjugacy except on the countable set $\mathbb{Q}_{\rm dr}^2$. 
\hruleskip

\subsection{2.28.}
Let us denote $f(x,y) = 2x+y \ ({\rm mod} \ 1), g(x,y) = x+y \ ({\rm mod} \ 1)$. Let $l_1 = \{(x,y) \mid 2x+y=1\}, l_2 = \{(x,y) \mid 2x+y=2\}$ and $l_3 = \{(x,y) \mid x+y=1\}$. 
$f$ and $g$ are continuous on $(0,1)^2\setminus (l_1\cup l_2 \cup l_3)$. The one-sided limits from below and above on the gluing boundaries: a pair of $\{0\}\times [0,1), \{1\}\times [0,1)$, a pair of $[0,1)\times\{0\}, [0,1)\times\{1\}$, $l_1, l_2$ and $l_3$, coincide by identifying $0$ and $1$. Thus the cap map is continuous. 
We obtain $f_x=2,f_y=1,g_x=1,g_y=1$ on $(0,1)^2$. The one-sided derivatives coincide on the gluing boundaries and they are continuous. Thus the cat map is $C^1$. The second or higher partial derivatives are all zeros, so they coincide on the gluing boundaries and are continuous.  Thus the cat map is $C^\infty$.

Almost the same argument leads to the $C^\infty$ regularity of the inverse map.
\hruleskip

\subsection{2.30.}
Let us denote $g(x,y) = 2x-y+a\sin{(2\pi x)} \ ({\rm mod} \ 1), h(x,y) = x$. Let $l = \{(x,y) \mid 2x-y+a\sin(2\pi x) \in \mathbb{Z}\}$. $g, h$ are continuous on $(0,1)^2\setminus l$. 
The following equations
\begin{align}
    & g(0+,y) = -y \ ({\rm mod} \ 1) = 2 - y \ ({\rm mod} \ 1) = g(1-,y) \nonumber \\
    & g(x,0+) = 2x+a\sin{(2\pi x)} \ ({\rm mod} \ 1)= 2x-1+a\sin{(2\pi x)}\ ({\rm mod} \ 1) = g(x,1-) \nonumber
\end{align}
say that $g$ and $h$ are continuous on $\{0\}\times [0,1)$ and $[0,1)\times\{0\}$. They are also continuous on $l$ since $0$ and $1$ are identified. Thus the standard map is continuous. 
We obtain $g_x = 2+2a\pi\cos{(2\pi x)}, g_y = -1, h_x = 1, h_y =0$ on $(0,1)^2$. They are all periodic of period $1$ and hence continuous on $\{0\}\times [0,1)$ and $[0,1)\times\{0\}$. Thus it is $C^1$. 
The higher partial derivatives are also $1$-peridic continuous function. Therefore $C^\infty$ regularity follows. 
\vskip 1.0em

The inverse map is given as
\begin{equation}
    f^{-1}(x,y) =\left(\begin{array}{c}
        y \\
        -x +2y + a\sin(2\pi y) \ ({\rm mod}\ 1)
    \end{array} \right) .
\end{equation}
Almost the same argument leads to the $C^\infty$ regularity of the inverse map.
\hruleskip

\subsection{2.32.}
The inverse map is given as
\begin{equation}
    f^{-1}(x,y) =\left(\begin{array}{c}
        y/b \\
        x -1 + ay^2/b^2
    \end{array} \right) .
\end{equation}
\hruleskip

\subsection{2.38.}
Let $V = \prod_{j=1}^D[0,L_j), C = 1/\prod_{j=1}^D{L_j}, \mathcal{K} = \{ 2\pi (k_1/L_1, k_2/L_2, \cdots, k_D/L_D) \mid (k_j)_{j=1}^D \in \mathbb{Z}^D\}, u_j({\bm k}):=\hat{v}_j({\bm k})=C \int_V{v_j({\bm x})e^{-i{\bm k}\cdot{\bm x}}\mathbf{d}^D{\bm x}}$. The inverse Fourier transform is 
\begin{equation}
    v_j({\bm x})=\sum_{{\bm k}'\in \mathcal{K}}{u_j({\bm k}')e^{i{\bm k}'\cdot{\bm x}}}. \label{invFT}
\end{equation} 
By plugging the r.h.s of Eq.~(\ref{invFT}) in each term of the Navier-Stokes equation, we obtain 
\begin{align}
    &\partial_t v_j({\bm x}) = \partial_t \sum_{{\bm k}'\in \mathcal{K}}{u_j({\bm k}')e^{i{\bm k}'\cdot{\bm x}}}, \\
    &\mu (\Delta {\bm v})_j = -\mu \sum_{{\bm k}'\in \mathcal{K}}{|{\bm k}'|^2 u_j({\bm k}')e^{i{\bm k}'\cdot{\bm x}}}, \\
    &\frac{f_j}{\varrho} = \sum_{{\bm k}'\in \mathcal{K}}{\frac{\hat{f}_j({\bm k}')}{\varrho}e^{i{\bm k}'\cdot{\bm x}}}, \\
    &[({\bm v}\cdot \nabla){\bm v}]_j = \sum_{m=1}^D\sum_{{\bm k}_1'\in \mathcal{K}}{u_m({\bm k}_1')e^{i{\bm k}_1'\cdot{\bm x}}}\left(\partial_{m}\sum_{{\bm k}_2'\in \mathcal{K}}{u_j({\bm k}_2')e^{i{\bm k}_2'\cdot{\bm x}}}\right) \nonumber \\
    & =  \sum_{m=1}^D\sum_{{\bm k}_1'\in \mathcal{K}}\sum_{{\bm k}_2'\in \mathcal{K}} ik_{2,m}' u_m({\bm k}_1')u_j({\bm k}_2')e^{i({\bm k}_1'+{\bm k}_2')\cdot{\bm x}}, \label{eq. nsterm1}\\
    &{\rm div}[({\bm v}\cdot \nabla){\bm v}] = \sum_{n=1}^D\sum_{m=1}^D\sum_{{\bm k}_1'\in \mathcal{K}}\sum_{{\bm k}_2'\in \mathcal{K}} -k_{2,m}'(k_{1,n}'+k_{2,n}') u_m({\bm k}_1')u_n({\bm k}_2')e^{i({\bm k}_1'+{\bm k}_2')\cdot{\bm x}}, \nonumber \\
    &\Delta^{-1}{\rm div}[({\bm v}\cdot \nabla){\bm v}] = \sum_{n=1}^D\sum_{m=1}^D\sum_{{\bm k}_1'\in \mathcal{K}}\sum_{{\bm k}_2'\in \mathcal{K}} \frac{k_{2,m}'(k_{1,n}'+k_{2,n}')}{|{\bm k}_1' + {\bm k}_2'|^2} u_m({\bm k}_1')u_n({\bm k}_2')e^{i({\bm k}_1'+{\bm k}_2')\cdot{\bm x}}, \nonumber \\
    &[\nabla \Delta^{-1}{\rm div}[({\bm v}\cdot \nabla){\bm v}]]_j = \sum_{n=1}^D\sum_{m=1}^D\sum_{{\bm k}_1'\in \mathcal{K}}\sum_{{\bm k}_2'\in \mathcal{K}} i\frac{k_{2,m}'(k_{1,n}'+k_{2,n}')(k_{1,j}'+k_{2,j}')}{|{\bm k}_1' + {\bm k}_2'|^2} u_m({\bm k}_1')u_n({\bm k}_2')e^{i({\bm k}_1'+{\bm k}_2')\cdot{\bm x}}. \label{eq. nsterm2}
\end{align}
The incompressibility implies 
\begin{align}
    0 = {\rm div}{\bm v} = \sum_{n=1}^D\sum_{{\bm k}'\in \mathcal{K}}{ik_n' u_n({\bm k}')e^{i{\bm k}'\cdot{\bm x}}}.
\end{align}
This leads to 
\begin{equation}
    \sum_{n=1}^D k_n' u_n({\bm k}') = 0
\end{equation}
for all ${\bm k}'\in \mathcal{K}$, since $\{e^{i{\bm k}'\cdot{\bm x}}\}_{{\bm k}'}$ is a basis. In particular, 
\begin{equation}
    \sum_{m=1}^D (k_{1,m}' + k_{2,m}')u_m({\bm k}_1') = \sum_{m=1}^Dk_{1,m}'u_m({\bm k}_1')+\sum_{m=1}^Dk_{2,m}'u_m({\bm k}_1') = \sum_{m=1}^Dk_{2,m}'u_m({\bm k}_1').
\end{equation}
Thus, the terms (\ref{eq. nsterm1}, \ref{eq. nsterm2}) are rewritten as 
\begin{align}
    &[({\bm v}\cdot \nabla){\bm v}]_j =  \sum_{m=1}^D\sum_{{\bm k}_1'\in \mathcal{K}}\sum_{{\bm k}_2'\in \mathcal{K}} i(k_{1,m}'+k_{2,m}') u_m({\bm k}_1')u_j({\bm k}_2')e^{i({\bm k}_1'+{\bm k}_2')\cdot{\bm x}}, \\
    &[\nabla \Delta^{-1}{\rm div}[({\bm v}\cdot \nabla){\bm v}]]_j = \sum_{n=1}^D\sum_{m=1}^D\sum_{{\bm k}_1'\in \mathcal{K}}\sum_{{\bm k}_2'\in \mathcal{K}} i\frac{(k_{1,m}'+k_{2,m}')(k_{1,n}'+k_{2,n}')(k_{1,j}'+k_{2,j}')}{|{\bm k}_1' + {\bm k}_2'|^2} u_m({\bm k}_1')u_n({\bm k}_2')e^{i({\bm k}_1'+{\bm k}_2')\cdot{\bm x}}.
\end{align}
By using the orthogonality
\begin{equation}
    \langle e^{i{\bm k}'\cdot{\bm x}},e^{i{\bm k}\cdot{\bm x}}  \rangle = C^{-1} \delta_{{\bm k}',{\bm k}}, 
\end{equation}
we obtain 
\begin{align}
    &C\langle \partial_t v_j({\bm x}), e^{i{\bm k}\cdot{\bm x}}  \rangle  = \dot{u}_j({\bm k}), \\
    &C\langle \mu (\Delta {\bm v})_j, e^{i{\bm k}\cdot{\bm x}}  \rangle  =-\mu|{\bm k}|^2 u_j({\bm k}), \\
    &C\left\langle \frac{f_j}{\varrho}, e^{i{\bm k}\cdot{\bm x}}  \right\rangle  =\frac{\hat{f}_j({\bm k})}{\varrho}, \\
    &C\langle [({\bm v}\cdot \nabla){\bm v}]_j, e^{i{\bm k}\cdot{\bm x}}  \rangle  = \sum_{m=1}^D ik_m\sum_{{\bm k}_1'+{\bm k}_2' = {\bm k}}u_m({\bm k}_1')u_j({\bm k}_2') = \sum_{n=1}^D \delta_{n,j} \sum_{m=1}^D ik_m\sum_{{\bm k}_1'+{\bm k}_2' = {\bm k}}u_m({\bm k}_1')u_j({\bm k}_2'),\\
    &C\langle [\nabla \Delta^{-1}{\rm div}[({\bm v}\cdot \nabla){\bm v}]]_j, e^{i{\bm k}\cdot{\bm x}}  
    \rangle = \sum_{n=1}^D\sum_{m=1}^D i\frac{k_m k_n k_j}{|{\bm k}|^2}  \sum_{{\bm k}_1'+{\bm k}_2' = {\bm k}}u_m({\bm k}_1')u_j({\bm k}_2').
\end{align}
The desired expression is obtained as 
\begin{equation}
    \dot{u}_j({\bm k}) = -\mu|{\bm k}|^2 u_j({\bm k}) - i\sum_{n=1}^D \left(\delta_{n,j} - \frac{k_n k_j}{|{\bm k}|^2} \right) \sum_{m=1}^D k_m\sum_{{\bm k}_1'+{\bm k}_2' = {\bm k}}u_m({\bm k}_1')u_j({\bm k}_2')+\frac{\hat{f}_j({\bm k})}{\varrho}.
\end{equation}
\end{document}